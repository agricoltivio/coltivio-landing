---
import type { Translations } from '@/i18n/translations'
import { NewsletterForm } from './NewsletterForm'
import { LanguageSwitcher } from './LanguageSwitcher'

interface Props {
  tr: Translations
  lang: string
}

const { tr, lang } = Astro.props

const appUrl = import.meta.env.PUBLIC_APP_URL ?? 'https://app.coltivio.ch'
const apiUrl = import.meta.env.PUBLIC_API_URL ?? 'https://api.coltivio.ch'

// Reusable phone mockup markup
const phoneMockup = (src: string, rotateCls: string, wrapCls = '') => `
  <div class="flex justify-center ${wrapCls}">
    <div class="${rotateCls} relative w-52 rounded-[2.5rem] border-4 border-foreground/15 shadow-2xl overflow-hidden aspect-[9/19]" style="background-color:#f6f6f6">
      <div class="absolute top-3 left-1/2 -translate-x-1/2 w-16 h-4 rounded-full bg-foreground/10 z-10"></div>
      <img src="${src}" alt="" class="absolute inset-0 h-full w-full object-cover" onerror="this.style.display='none'" />
    </div>
  </div>
`
---

<div class="min-h-screen bg-background text-foreground">

  {/* ── Navbar ─────────────────────────────────────────────── */}
  <header class="sticky top-0 z-50 border-b bg-background/80 backdrop-blur supports-[backdrop-filter]:bg-background/60">
    <div class="container mx-auto flex h-14 items-center justify-between px-4">
      <div class="flex items-center gap-2 font-semibold text-lg">
        <img src="/logo.png" alt="Coltivio" class="h-7" />
        Coltivio
      </div>
      <div class="flex items-center gap-2">
        <LanguageSwitcher client:load lang={lang} />
      </div>
    </div>
  </header>

  {/* ── Hero ───────────────────────────────────────────────── */}
  <section class="container mx-auto flex min-h-[calc(100vh-3.5rem)] items-center px-4 py-16">
    <div class="grid gap-12 md:grid-cols-2 md:items-center w-full">
      <div class="space-y-6">
        <h1 class="text-4xl font-bold tracking-tight md:text-7xl whitespace-pre-line">
          {tr.hero.headline}
        </h1>
        <p class="text-lg text-muted-foreground max-w-lg md:text-xl">
          {tr.hero.sub}
        </p>
        <div class="space-y-4">
          <p class="text-sm font-medium text-muted-foreground border rounded-lg px-4 py-3 bg-muted/40">
            {tr.hero.testPhase}
          </p>
          <div class="flex flex-wrap gap-3">
            <a
              href="https://testflight.apple.com/join/MZ3HNzDW"
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center justify-center rounded-md bg-primary px-6 py-3 text-base font-medium text-primary-foreground hover:bg-primary/90 transition-colors"
            >
              {tr.hero.ctaIos}
            </a>
            <a
              href="mailto:support@coltivio.ch?subject=Android%20Beta%20Test&body=Hallo%2C%20bitte%20freischalten%20f%C3%BCr%20Android%20Test%2C%20hier%20mein%20PlayStore%20Google%20Account%20Email%20%3C%3D%3D%3D%20bitte%20Email%20angeben%20%3D%3D%3D%3E"
              class="inline-flex items-center justify-center rounded-md border border-input bg-background px-6 py-3 text-base font-medium hover:bg-muted transition-colors"
            >
              {tr.hero.ctaAndroid}
            </a>
          </div>
        </div>
      </div>

      <div class="flex justify-center md:justify-end lg:justify-center">
        <Fragment set:html={phoneMockup('/screenshots/home.png', 'md:-rotate-3', 'md:order-first')} />
      </div>
    </div>
  </section>

  {/* ── Story ──────────────────────────────────────────────── */}
  <section class="border-t py-20">
    <div class="container mx-auto px-4 max-w-3xl space-y-10">
      <h2 class="text-3xl font-bold md:text-4xl">{tr.story.headline}</h2>
      <div class="space-y-4 text-muted-foreground text-lg leading-relaxed">
        <p>{tr.story.founders}</p>
        <p>{tr.story.problem}</p>
        <p class="text-foreground font-medium">{tr.story.born}</p>
      </div>
    </div>
  </section>

  {/* ── Features ───────────────────────────────────────────── */}
  <section class="border-t py-20">
    <div class="container mx-auto px-4 space-y-20">
      <p class="text-sm font-medium text-muted-foreground uppercase tracking-wider">
        {tr.fieldwork.sub}
      </p>

      {/* Field Work */}
      <div class="grid gap-12 lg:grid-cols-2 md:items-center">
        <div class="space-y-6">
          <h3 class="text-2xl font-bold">{tr.fieldwork.title}</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
              <div class="pt-6 px-6 pb-6 space-y-2">
                <h4 class="font-semibold">{tr.fieldwork.plots.title}</h4>
                <p class="text-sm text-muted-foreground leading-relaxed">{tr.fieldwork.plots.desc}</p>
              </div>
            </div>
            <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
              <div class="pt-6 px-6 pb-6 space-y-2">
                <h4 class="font-semibold">{tr.fieldwork.protection.title}</h4>
                <p class="text-sm text-muted-foreground leading-relaxed">{tr.fieldwork.protection.desc}</p>
              </div>
            </div>
            <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
              <div class="pt-6 px-6 pb-6 space-y-2">
                <h4 class="font-semibold">{tr.fieldwork.harvest.title}</h4>
                <p class="text-sm text-muted-foreground leading-relaxed">{tr.fieldwork.harvest.desc}</p>
              </div>
            </div>
            <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
              <div class="pt-6 px-6 pb-6 space-y-2">
                <h4 class="font-semibold">{tr.fieldwork.export.title}</h4>
                <p class="text-sm text-muted-foreground leading-relaxed">{tr.fieldwork.export.desc}</p>
              </div>
            </div>
          </div>
        </div>
        <Fragment set:html={phoneMockup('/screenshots/fieldwork.png', 'lg:rotate-3')} />
      </div>

      {/* Animal Husbandry */}
      <div class="grid gap-12 lg:grid-cols-2 md:items-center">
        {/* Desktop: image left */}
        <Fragment set:html={phoneMockup('/screenshots/animals.png', 'lg:-rotate-3', 'hidden lg:flex')} />
        <div class="space-y-6">
          <h3 class="text-2xl font-bold">{tr.animals.title}</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
              <div class="pt-6 px-6 pb-6 space-y-2">
                <h4 class="font-semibold">{tr.animals.import.title}</h4>
                <p class="text-sm text-muted-foreground leading-relaxed">{tr.animals.import.desc}</p>
              </div>
            </div>
            <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
              <div class="pt-6 px-6 pb-6 space-y-2">
                <h4 class="font-semibold">{tr.animals.treatments.title}</h4>
                <p class="text-sm text-muted-foreground leading-relaxed">{tr.animals.treatments.desc}</p>
              </div>
            </div>
            <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
              <div class="pt-6 px-6 pb-6 space-y-2">
                <h4 class="font-semibold">{tr.animals.turnout.title}</h4>
                <p class="text-sm text-muted-foreground leading-relaxed">{tr.animals.turnout.desc}</p>
              </div>
            </div>
            <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
              <div class="pt-6 px-6 pb-6 space-y-2">
                <h4 class="font-semibold">{tr.animals.export.title}</h4>
                <p class="text-sm text-muted-foreground leading-relaxed">{tr.animals.export.desc}</p>
              </div>
            </div>
          </div>
        </div>
        {/* Mobile: image below text */}
        <Fragment set:html={phoneMockup('/screenshots/animals.png', '', 'sm:flex lg:hidden')} />
      </div>

      {/* Demo video */}
      <div class="space-y-6">
        <h3 class="text-2xl font-bold">{tr.demo.title}</h3>
        <div class="relative w-full overflow-hidden rounded-xl aspect-video">
          <iframe
            src="https://www.youtube.com/embed/7dShhXfILDM"
            title={tr.demo.title}
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
            class="absolute inset-0 w-full h-full"
          />
        </div>
      </div>
    </div>
  </section>

  {/* ── Customization ──────────────────────────────────────── */}
  <section class="border-t py-20">
    <div class="container mx-auto px-4 max-w-3xl space-y-10">
      <div class="space-y-4">
        <h2 class="text-3xl font-bold md:text-4xl">{tr.customize.headline}</h2>
        <p class="text-lg text-muted-foreground leading-relaxed">{tr.customize.sub}</p>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
          <div class="pt-6 px-6 pb-6 space-y-2">
            <h4 class="font-semibold">{tr.customize.speedDial.title}</h4>
            <p class="text-sm text-muted-foreground leading-relaxed">{tr.customize.speedDial.desc}</p>
          </div>
        </div>
        <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
          <div class="pt-6 px-6 pb-6 space-y-2">
            <h4 class="font-semibold">{tr.customize.modules.title}</h4>
            <p class="text-sm text-muted-foreground leading-relaxed">{tr.customize.modules.desc}</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  {/* ── Web App ────────────────────────────────────────────── */}
  <section class="border-t bg-muted/30 py-20">
    <div class="container mx-auto px-4 space-y-20">
      <p class="text-sm font-medium text-muted-foreground uppercase tracking-wider">
        {tr.webapp.label}
      </p>
      <div class="space-y-6 max-w-3xl">
        <h2 class="text-2xl font-bold">{tr.webapp.title}</h2>
        <p class="text-muted-foreground">{tr.webapp.body}</p>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
            <div class="pt-6 px-6 pb-6 space-y-2">
              <h4 class="font-semibold">{tr.webapp.contacts.title}</h4>
              <p class="text-sm text-muted-foreground leading-relaxed">{tr.webapp.contacts.desc}</p>
            </div>
          </div>
          <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
            <div class="pt-6 px-6 pb-6 space-y-2">
              <h4 class="font-semibold">{tr.webapp.orders.title}</h4>
              <p class="text-sm text-muted-foreground leading-relaxed">{tr.webapp.orders.desc}</p>
            </div>
          </div>
          <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
            <div class="pt-6 px-6 pb-6 space-y-2">
              <h4 class="font-semibold">{tr.webapp.sponsorships.title}</h4>
              <p class="text-sm text-muted-foreground leading-relaxed">{tr.webapp.sponsorships.desc}</p>
            </div>
          </div>
        </div>
        <span class="inline-flex items-center gap-2 rounded-md border border-input bg-muted/50 px-6 py-3 text-base font-medium text-muted-foreground">
          Coming Soon
        </span>
      </div>
    </div>
  </section>

  {/* ── OSS ────────────────────────────────────────────────── */}
  <section class="border-t py-20">
    <div class="container mx-auto px-4 max-w-3xl space-y-8">
      <h2 class="text-3xl font-bold">{tr.story.ossTitle}</h2>
      <div class="space-y-4 text-muted-foreground leading-relaxed">
        <p>{tr.story.oss}</p>
        <p>{tr.story.data}</p>
        <p>{tr.story.funding}</p>
      </div>
      <a
        href="https://github.com/orgs/agricoltivio/repositories"
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center gap-2 rounded-md border border-input bg-background px-6 py-3 text-base font-medium hover:bg-muted transition-colors"
      >
        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/>
        </svg>
        {tr.oss.github} →
      </a>
    </div>
  </section>

  {/* ── Newsletter ─────────────────────────────────────────── */}
  <section class="border-t py-20">
    <div class="container mx-auto px-4 max-w-2xl space-y-6">
      <h2 class="text-3xl font-bold">{tr.newsletter.title}</h2>
      <p class="text-muted-foreground">{tr.newsletter.sub}</p>
      <NewsletterForm
        client:load
        apiUrl={apiUrl}
        lang={lang}
        placeholder={tr.newsletter.placeholder}
        cta={tr.newsletter.cta}
        successMsg={tr.newsletter.success}
        errorMsg={tr.newsletter.error}
      />
    </div>
  </section>

  {/* ── Footer ─────────────────────────────────────────────── */}
  <footer class="border-t py-10">
    <div class="container mx-auto px-4 space-y-6">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div class="flex items-center gap-2 font-semibold">
          <img src="/icon.png" alt="Coltivio" class="h-5 w-5" />
          Coltivio · {tr.footer.tagline}
        </div>
        <div class="flex flex-wrap gap-3 text-sm">
          <a href="https://github.com/orgs/agricoltivio/repositories" target="_blank" rel="noopener noreferrer" class="px-3 py-1.5 rounded hover:bg-muted transition-colors text-muted-foreground hover:text-foreground">
            {tr.footer.github}
          </a>
          <a href="https://testflight.apple.com/join/MZ3HNzDW" target="_blank" rel="noopener noreferrer" class="px-3 py-1.5 rounded hover:bg-muted transition-colors text-muted-foreground hover:text-foreground">
            {tr.footer.iosBeta}
          </a>
          <a href="mailto:support@coltivio.ch?subject=Android%20Beta%20Test&body=Hallo%2C%20bitte%20freischalten%20f%C3%BCr%20Android%20Test%2C%20hier%20mein%20PlayStore%20Google%20Account%20Email%20%3C%3D%3D%3D%20bitte%20Email%20angeben%20%3D%3D%3D%3E" class="px-3 py-1.5 rounded hover:bg-muted transition-colors text-muted-foreground hover:text-foreground">
            {tr.footer.androidBeta}
          </a>
        </div>
      </div>
      <div class="flex flex-wrap gap-4 text-sm text-muted-foreground">
        <a href={`${appUrl}/imprint`} class="hover:underline">Impressum</a>
        <a href={`${appUrl}/privacy`} class="hover:underline">Datenschutz</a>
        <a href={`${appUrl}/data-deletion`} class="hover:underline">Datenlöschung</a>
        <span class="ml-auto">© 2025 Coltivio</span>
      </div>
    </div>
  </footer>

</div>
